{"version":3,"sources":["webpack:///src/app/dicom-viewer/thumbnail.directive.ts","webpack:///src/app/info-dialog/info-dialog.component.ts","webpack:///src/app/info-dialog/info-dialog.component.html","webpack:///src/app/dicom-viewer/dicom-viewer.module.ts","webpack:///src/environments/environment.ts","webpack:///src/app/app.component.ts","webpack:///src/app/app.component.html","webpack:///src/app/dicom-viewer/dicom-viewer.component.ts","webpack:///src/app/dicom-viewer/dicom-viewer.component.html","webpack:///src/app/app.module.ts","webpack:///src/app/dragdrop/dragdrop.directive.ts","webpack:///src/app/dicom-viewer/cornerstone.directive.ts","webpack:///src/app/app-routing.module.ts","webpack:///src/main.ts","webpack:///$_lazy_route_resource lazy namespace object"],"names":["ThumbnailDirective","elementRef","element","nativeElement","cornerstone","enable","setImageData","imageData","refresh","image","viewport","getDefaultViewportForImage","displayImage","fitToWindow","resize","InfoDialogComponent","DicomViewerModule","environment","production","AppComponent","dialog","cornerstoneWADOImageLoader","external","webWorkerManager","initialize","webWorkerPath","taskConfiguration","codecsPath","event","handler","preventDefault","document","getElementById","focus","key","click","documentElement","dialogRef","open","panelClass","autoFocus","afterClosed","subscribe","result","fileType","type","fileList","Array","from","file","length","viewPort","loadToolState","loadDICOMImages","files","imageList","sort","a","b","name","wadouri","dataSetCacheManager","purge","i","dicomFile","getActualImage","imageId","fileManager","add","push","resetAllTools","loadStudyImages","alert","onFileDropped","openDialog","DICOMViewerComponent","http","enableViewerTools","enablePlayTools","downloadImagesURL","maxImagesToLoad","seriesList","currentSeriesIndex","currentSeries","imageCount","loadedImages","imageIdList","targetImageCount","loadingImages","annotationsList","toolList","selectedTool","baseUrl","imagesToLoad","Math","min","toString","display","tool","isScrollEnabled","isClipPlaying","resetViewer","resetImageCache","maxImages","index","loadAndCacheImage","then","imageLoaded","series","studyID","data","string","seriesID","seriesNumber","intString","studyDescription","seriesDescription","seriesIndex","findIndex","item","seriesItem","showSeries","enablePan","stopClip","addImageData","currentIndex","nextImage","previousImage","cornerstoneTools","setToolActiveForElement","mouseButtonMask","toggleScroll","filename","text","createElement","setAttribute","encodeURIComponent","style","body","appendChild","removeChild","exportArray","exportImageArray","download","JSON","stringify","lastSeriesSeen","lastCurrentImageIndex","console","log","imageAnnotations","SOPInstanceUID","annotations","lengthData","rectangleData","getter","getElementToolStateManager","get","lengthToolData","rectangleRoiToolData","reader","FileReader","readAsText","onload","evt","idToAnnotation","Map","jsonObj","parse","target","set","currSOPInstanceUID","rectData","has","addToolState","enableRectangle","enableLength","refreshImage","onerror","playClip","frameRate","stackState","getToolState","undefined","togglePlayClip","getViewport","invert","setViewport","popped","pop","clearToolState","confirm","arrayBuffer","realImage","Blob","Uint8Array","formData","FormData","append","post","response","url","window","AppModule","provide","useValue","appearance","DragdropDirective","fileDropped","stopPropagation","fileOver","dataTransfer","emit","CornerstoneDirective","fontFamily","fontSize","patientName","hospital","instanceNumber","scrollEnabled","isCornerstoneEnabled","clipPlaying","WwwcTool","PanTool","ZoomTool","LengthTool","RectangleRoiTool","ZoomTouchPinchTool","PanMultiTouchTool","StackScrollTool","deltaY","Hammer","cornerstoneMath","init","globalToolSyncEnabled","textStyle","setFont","toolStyle","setToolWidth","toolColors","setToolColor","setActiveColor","addTool","currentImage","round","voi","windowWidth","windowCenter","scale","toFixed","disableViewer","disable","replace","stack","currentImageIdIndex","imageIds","addStackStateManager","setToolDisabledForElement","routes","AppRoutingModule","forRoot","bootstrapModule","err","error","webpackEmptyAsyncContext","req","Promise","resolve","e","Error","code","keys","module","exports","id"],"mappings":"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","file":"main-es5.js","sourcesContent":["import { Directive, ElementRef, OnInit, Input, AfterViewChecked } from '@angular/core';\n\n\ndeclare const cornerstone;\n\n\n@Directive({\n  selector: '[thumbnail]',\n})\n\nexport class ThumbnailDirective implements OnInit, AfterViewChecked {\n\n  @Input() public imageData: any;\n\n  public element: any;\n\n  constructor(private elementRef: ElementRef) {\n  }\n\n  ngOnInit() {\n // Retrieve the DOM element itself\n    this.element = this.elementRef.nativeElement;\n\n    // Enable the element with Cornerstone\n    cornerstone.enable(this.element);\n    this.setImageData(this.imageData);\n  }\n\n  ngAfterViewChecked() {\n    this.refresh();\n  }\n\n  public refresh() {\n    this.setImageData(this.imageData);\n  }\n\n  public setImageData(image) {\n    this.imageData = image;\n    if (this.imageData && this.element) {\n      const viewport = cornerstone.getDefaultViewportForImage(this.element, this.imageData);\n      cornerstone.displayImage(this.element, this.imageData, viewport);\n      // Fit the image to the viewport window\n      cornerstone.fitToWindow(this.element);\n      cornerstone.resize(this.element, true);\n    }\n\n  }\n}\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'info-dialog',\n  templateUrl: './info-dialog.component.html',\n  styleUrls: ['./info-dialog.component.scss']\n})\nexport class InfoDialogComponent implements OnInit {\n\n  constructor() {\n  }\n\n  ngOnInit(): void {\n  }\n\n}\n","<h1 mat-dialog-title><img\n  width=\"190\"\n  alt=\"DeepHealth Logo\"\n  src=\"assets/svg/deephealth.svg\"\n  style=\"margin-top: 0.25%\"\n/> DICOM Annotation Tool</h1>\n<mat-dialog-content class=\"mat-typography\">\n  <h1>Overview</h1>\n  <p style=\"border-bottom: #696969 1px inset; padding-bottom: 2%;\">The DeepHealth Annotate DICOM Image Annotation Tool is a web-based platform for viewing and\n    annotating DICOM files. \n    <br><br>\n    Tools are included for rectangular box and length measurement type annotations. The annotation \n    metadata can then be exported as a .JSON file, which is intended to be parsed and used as training input for\n    deep learning models, so that algorithms can more accurately identify these regions of interest within similar\n    images in the future.\n    <br><br>\n    You can get started by clicking the \"<i>Choose DICOM Files</i>\" button in the top-right corner of the screen and\n    then browsing to select all of the desired DICOM files to import from your local machine. You may also drag and drop the files\n    directly onto the viewer window. If you would like to learn more about the viewer and annotation tools available, please continue reading below.\n  </p>\n\n  <br>\n  <h1>Annotation Tools</h1>\n  <span class=\"far fa-square\" style=\"font-size: 20pt;\"></span>\n  <h4>Rectangle ROI</h4>\n  <h4>(Shortcut: R)</h4>\n  <p>This button will enable the Rectangular Box Tool, which allows you to draw a box around a region of interest.\n    With the tool enabled, click a point on the image to place the first corner of the box, then click again to place the opposite corner, and a\n    box will be drawn for you.<br><br>\n    The annotation metadata generated by this tool includes x and y coordinates for the top-left corner of the box, as well as width and\n    height values for the box.\n  </p>\n  <br>\n  <span class=\"fas fa-ruler-horizontal\" style=\"font-size: 20pt;\"></span>\n  <h4>Length</h4>\n  <h4>(Shortcut: L)</h4>\n  <p style=\"border-bottom: #696969 1px inset; padding-bottom: 2%;\">This button will enable the\n    Length Measurement Tool, which allows you to draw a straight line on the image that includes automatically calculated length values. Simply\n    click the point where you want the line to begin, then the end point, and the line will be drawn for you.\n    This is useful for annotating the distance between two regions of interest, or measuring the length of any region. It may also be useful\n    for annotating thin regions of interest that are not efficiently captured using the rectangular box tool.<br><br>\n    The annotation metadata generated by this tool includes x and y coordinates for the start and end points of the line, as well as a numerical length value\n    and a string defining the units of length.</p>\n  <br>\n\n  <h1>View Tools</h1>\n  <span class=\"fa fa-search\" style=\"font-size: 20pt;\"></span>\n  <h4>Search</h4>\n  <h4>(Shortcut: P)</h4>\n  <p>This button enables the Pan Tool, which allows panning around the current active image using the left mouse button. Pan is\n    also possible by default by using the right mouse button while any other tool is active.</p>\n  <br>\n\n  <span class=\"fa fa-arrows-alt\" style=\"font-size: 20pt;\"></span>\n  <h4>Pan</h4>\n  <h4>(Shortcut: P)</h4>\n  <p>This button enables the Pan Tool, which allows panning around the current active image using the left mouse button. Pan is\n    also possible by default by using the right mouse button while any other tool is active.</p>\n  <br>\n  <span class=\"fas fa-search-plus\" style=\"font-size: 20pt;\"></span>\n  <h4>Zoom</h4>\n  <h4>(Shortcut: Z)</h4>\n  <p>This button will enable the Zoom Tool, which allows you to adjust the zoom value of the current image using the left\n    mouse button. With the tool chosen, click and drag along the viewer y-axis: Down to zoom in, up to zoom out.</p>\n  <br>\n  <span class=\"fa fa-sun\" style=\"font-size: 20pt;\"></span>\n  <h4>Windowing</h4>\n  <h4>(Shortcut: W)</h4>\n  <p>This button will enable the Windowing tool, which allows you to change the viewer's windowing \n    values using the left mouse button. With the tool chosen, click and drag along the viewer x-axis to increase\n    or decrease the WW value (Window Width, also known as contrast), or along the y-axis to adjust the WL value (Window Level,\n    also known as brightness).</p>\n  <br>\n  <span class=\"fa fa-adjust\" style=\"font-size: 20pt;\"></span>\n  <h4>Invert</h4>\n  <h4>(Shortcut: I)</h4>\n  <p>This button will invert the image colors.</p>\n  <br>\n  <span class=\"fas fa-undo\" style=\"font-size: 20pt;\"></span>\n  <h4>Undo Annotation</h4>\n  <h4>(Shortcut: U)</h4>\n  <p>This button will undo any annotations created with the last used tool.</p>\n  <br>\n  <span class=\"fas fa-trash-alt\" style=\"font-size: 20pt;\"></span>\n  <h4>Reset Image</h4>\n  <h4>(Shortcut: Esc)</h4>\n  <p>This button resets the current image to its initial state. This includes removing all annotations, as well as\n    resetting zoom, windowing, and positioning.</p>\n  <br>\n  <span class=\"fa fa-backward\" style=\"font-size: 20pt;\"></span>\n  <h4>Previous Image</h4>\n  <h4>(Shortcut: Left or Up arrows)</h4>\n  <p>If a multi-frame image is selected in the viewer, this button will move to the previous frame in the stack.</p>\n  <br>\n  <span class=\"fa fa-forward\" style=\"font-size: 20pt;\"></span>\n  <h4>Next Image</h4>\n  <h4>(Shortcut: Right or Down arrows)</h4>\n  <p>If a multi-frame image is selected in the viewer, this button will move to the next frame in the stack.</p>\n  <br>\n  <span class=\"fa fa-bars\" style=\"font-size: 20pt;\"></span>\n  <h4>Toggle Stack Scroll</h4>\n  <h4>(Shortcut: S)</h4>\n  <p>Clicking this button will toggle the Stack Scroll tool on/off. Stack scrolling allows for\n    moving through an image stack in a multi-frame DICOM file using the mousewheel: Down for next frame,\n    up for previous frame.</p>\n  <br>\n  <span class=\"fa fa-play\" style=\"font-size: 20pt;\"></span>\n  <h4>Play Clip</h4>\n  <h4>(Shortcut: /)</h4>\n  <p>If a multi-frame image is selected in the viewer, this button will begin looping through the frames\n    at a default 10 frames per second. Click \"Stop Clip\" to end the loop and return to static image viewing.</p>\n  <br>\n  <span class=\"fa fa-stop\" style=\"font-size: 20pt;\"></span>\n  <h4>Stop Clip</h4>\n  <h4>(Shortcut: /)</h4>\n  <p style=\"border-bottom: #696969 1px inset; padding-bottom: 2%;\">If a multi-frame image is selected in the viewer and\n    currently playing, this button will end the play loop and return you to static image viewing. </p>\n      \n  <br>\n  <h1>Exporting</h1>\n  <span class=\"fa fa-download\" style=\"font-size: 20pt;\"></span>\n  <h4>Download Annotation Data</h4>\n  <h4>(Shortcut: Alt+Enter)</h4>\n  <p style=\"border-bottom: #696969 1px inset; padding-bottom: 2%;\">This button exports all current annotations on any loaded images to a .JSON file. In the\n    file, each DICOM image is represented as one JSON object containing any annotation metadata within that image as a set of key/value pairs. Therefore, the\n    contents of the file is simply a list containing one of these objects for each image. See below for example JSON properties.<br><br>\n    Simplified JSON example:<br><br>\n\n  <code>{{'{'}} \"width\":76,<br>\n    \"height\":25,<br>\n    \"left\":984,<br>\n    \"top\":353,<br>\n    \"uuid\":\"a084819e-f470-4477-af32-4a3d8a71b008\",<br>\n    \"x\":141,<br>\n    \"y\":152,<br>\n    \"length\":52,<br>\n    \"unit\":\"mm\" {{'}'}}</code><br><br>\n    \n    One of these .JSON files can then later be dropped onto the viewer to restore any annotations from the file onto their respective\n    images, provided those images are also currently loaded.</p>\n\n  <br>\n  <h1>Source &amp; Contributing</h1>\n  <p>This project is provided open-source (MIT license) and your contributions are welcome! Please visit our \n    <a aria-label=\"Project GitHub\" target=\"_blank\" rel=\"noopener\" href=\"https://github.com/umb-deephealth/deephealth-annotate\" title=\"Project GitHub\">GitHub</a>\n   repository for more information.</p>\n</mat-dialog-content>\n<mat-dialog-actions align=\"end\">\n  <button style=\"margin-right: 1%;\" mat-button mat-dialog-close>Close</button>\n</mat-dialog-actions>\n","import { NgModule } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\n\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\n\nimport { DICOMViewerComponent } from './dicom-viewer.component';\nimport { CornerstoneDirective } from './cornerstone.directive';\nimport { ThumbnailDirective } from './thumbnail.directive';\n\n@NgModule({\n  imports: [\n    FormsModule,\n    CommonModule,\n    MatProgressSpinnerModule\n  ],\n  declarations: [DICOMViewerComponent, CornerstoneDirective, ThumbnailDirective],\n  exports: [DICOMViewerComponent, CornerstoneDirective, ThumbnailDirective]\n})\nexport class DicomViewerModule { }\n","// This file can be replaced during build by using the `fileReplacements` array.\n// `ng build --prod` replaces `environment.ts` with `environment.prod.ts`.\n// The list of file replacements can be found in `angular.json`.\n\nexport const environment = {\n  production: false\n};\n\n/*\n * For easier debugging in development mode, you can import the following file\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\n *\n * This import should be commented out in production mode because it will have a negative impact\n * on performance if an error is thrown.\n */\n// import 'zone.js/dist/zone-error';  // Included with Angular CLI.\n","import { Component, OnInit, ViewChild } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { InfoDialogComponent } from './info-dialog/info-dialog.component'\nimport { DICOMViewerComponent } from './dicom-viewer/dicom-viewer.component';\nimport hotkeys from 'hotkeys-js';\n\n\ndeclare const cornerstone;\ndeclare const cornerstoneWADOImageLoader;\n\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss']\n})\nexport class AppComponent implements OnInit {\n\n  @ViewChild(DICOMViewerComponent, { static: true }) viewPort: DICOMViewerComponent;\n\n\n  constructor(public dialog: MatDialog) {}\n\n  ngOnInit() {\n    // Initialize the cornerstoneWADOImageLoaderCodecs\n    cornerstoneWADOImageLoader.external.cornerstone = cornerstone;\n    cornerstoneWADOImageLoader.webWorkerManager.initialize({\n        webWorkerPath: './assets/cornerstone/webworkers/cornerstoneWADOImageLoaderWebWorker.js',\n        taskConfiguration: {\n            'decodeTask': {\n                codecsPath: '../codecs/cornerstoneWADOImageLoaderCodecs.js'\n            }\n        }\n    });\n\n    // Setup all Keyboard Shortcuts here\n    hotkeys('p,z,w,i,r,l,alt+enter,u,esc,left,right,up,down,/,s', function(event, handler){\n      event.preventDefault();\n      document.getElementById(\"viewer\").focus();\n      switch(handler.key) {\n        case 'p':\n          document.getElementById('pan_bttn').click();\n          break;\n        case 'z':\n          document.getElementById('zoom_bttn').click();\n          break;\n        case 'w':\n          document.getElementById('windowing_bttn').click();\n          break;\n        case 'i':\n          document.getElementById('invert_bttn').click();\n          break;\n        case 'r':\n          document.getElementById('rectangleroi_bttn').click();\n          break;\n        case 'l': \n          document.getElementById('length_bttn').click();\n          break;\n        case 'alt+enter':\n          document.getElementById('export_bttn').click();\n          break;\n        case 'u':\n          document.getElementById('undo_bttn').click();\n          break;\n        case 'esc':\n          document.getElementById('reset_bttn').click();\n          break;\n        case 'left':\n        case 'up':\n          document.getElementById('previous_image_bttn').click();\n          break;\n        case 'right':\n        case 'down':\n          document.getElementById('next_image_bttn').click();\n          break;\n        case '/':\n          document.getElementById('play_bttn').click();\n          break;\n        case 's':\n          document.getElementById('stackscroll_bttn').click();\n          break;\n      }\n    });\n  }\n\n\n  ngAfterViewChecked(): void {\n    document.documentElement.focus();\n  }\n\n\n  openDialog() {\n    const dialogRef = this.dialog.open(InfoDialogComponent, {\n      panelClass: 'custom-modalbox',\n      autoFocus: false\n    });\n    \n    dialogRef.afterClosed().subscribe(result => {\n      //console.log(`Dialog result: ${result}`);\n    });\n  }\n\n\n  // File drag & drop handler, event contains a FileList\n  onFileDropped(event) {\n    let fileType = event[0].type;\n    let fileList: Array<File> = Array.from(event);\n    let file: File = fileList[0];\n\n    if (fileList.length == 1 && fileType == 'application/json') {\n      this.viewPort.loadToolState(event);\n    }\n    else {\n      this.loadDICOMImages(event);\n    }\n  }\n\n\n  /**\n   * Load selected DICOM images\n   *\n   * @param files list of selected dicom files\n   */\n  loadDICOMImages(files: FileList) {\n    if (files && files.length > 0) {\n      const imageList = [];\n      const fileList: Array<File> = Array.from(files);\n      fileList.sort((a, b) => {\n        if ( a.name > b.name ) { return 1; }\n        if ( b.name > a.name ) { return -1; }\n        return 0;\n      });\n      cornerstoneWADOImageLoader.wadouri.dataSetCacheManager.purge();\n\n      // loop thru the File list and build a list of wadouri imageIds (dicomfile:)\n      for (let i = 0; i < fileList.length; i++) {\n        const dicomFile: File = fileList[i];\n        this.viewPort.getActualImage(dicomFile);\n        const imageId = cornerstoneWADOImageLoader.wadouri.fileManager.add(dicomFile);\n        imageList.push(imageId);\n      }\n\n      this.viewPort.resetAllTools();\n\n      // now load all Images, using their wadouri\n      this.viewPort.loadStudyImages(imageList);\n\n    } else { alert('Choose DICOM images to display.'); }\n  }\n}\n","<!-- Main Content -->\n<div style=\"height:100%; width: 100%;\" appDragdrop (fileDropped)=\"onFileDropped($event)\">\n  <div style=\"display: flex; height: calc(100% - 60px); width:100%; margin-top: 3.3em;\">\n    <dicom-viewer [enableViewerTools]=\"true\" [enablePlayTools]=\"true\" id=\"viewer\" \n    style=\"height:100%; width:100%; margin: 1px; border: 2px solid #1a1a1a; font-size: 16px;\"></dicom-viewer>\n  </div>\n</div>\n\n<!-- Toolbar -->\n<div class=\"toolbar\" role=\"banner\">\n  <a aria-label=\"DeepHealth Home\" target=\"_blank\" rel=\"noopener\" href=\"https://deep.health\" title=\"DeepHealth\">\n  <img\n    width=\"170\"\n    alt=\"DeepHealth Logo\"\n    src=\"assets/svg/deephealth.svg\"\n    style=\"margin-top: 2%\"\n  />\n  </a>\n  <div class=\"spacer\"></div>\n  <div class=\"choose_file\">\n    Choose DICOM Files\n    <input class=\"hide_file\" type=\"file\" multiple accept=\"application/dicom\" id=\"images\" title=\"Select your images\"\n    (change)=\"loadDICOMImages($event.target.files)\">\n  </div>\n  <button mat-icon-button (click)=\"openDialog()\" style=\"margin: 10px; color: white;\"><mat-icon>help_outline</mat-icon></button>\n</div>\n\n\n<router-outlet></router-outlet>","import { Component, ViewChild, OnInit, Input, ViewChildren } from '@angular/core';\nimport { HttpClient, HttpRequest, HttpEvent } from '@angular/common/http';\nimport { CornerstoneDirective } from './cornerstone.directive';\nimport { ThumbnailDirective } from './thumbnail.directive';\n\ndeclare const cornerstone;\ndeclare const cornerstoneTools;\n\n\n@Component({\n  selector: 'dicom-viewer',\n  templateUrl: './dicom-viewer.component.html',\n  styleUrls: ['./dicom-viewer.component.css']\n})\nexport class DICOMViewerComponent implements OnInit {\n  \n  @ViewChild(CornerstoneDirective, { static: true }) viewPort: CornerstoneDirective; // the main cornerstone viewport\n  @ViewChildren(ThumbnailDirective) thumbnails: Array<ThumbnailDirective>;\n\n  @Input() public enableViewerTools = false; // enable viewer tools\n  @Input() public enablePlayTools = false;   // enable Play Clip tools\n  @Input() public downloadImagesURL = ''     // download images URL\n  @Input() public maxImagesToLoad = 9999999; // limit for the automatic loading of study images\n\n  public seriesList = []; // list of series on the images being displayed\n  public currentSeriesIndex = 0;\n  public currentSeries: any = {};\n  public imageCount = 0; // total image count being viewed\n\n  private loadedImages = [];\n  private imageIdList = [];\n  private element: any;\n  private targetImageCount = 0;\n  public loadingImages = false;\n\n  private annotationsList = []; // keep track of all tools/annotations used\n  private toolList = [\"Pan\", \"Zoom\", \"Wwwc\", \"RectangleRoi\", \"Length\"];\n  private selectedTool = '';\n  private baseUrl = 'http://18.118.139.210:5000/';\n  public realImage: any;\n \n  \n  constructor(private http: HttpClient) { }\n\n\n  ngOnInit() {\n    this.element = this.viewPort.element;\n  }\n  \n\n  // control message for more images to load\n  public get moreImagestoLoad(): string {\n    if (this.loadedImages.length < this.imageIdList.length && !this.loadingImages) { // are there any more images to load?\n      const imagesToLoad = (this.maxImagesToLoad <= 0) ? (this.imageIdList.length - this.loadedImages.length) : Math.min(this.maxImagesToLoad, this.imageIdList.length - this.loadedImages.length);\n      return imagesToLoad.toString();\n    } else return '';\n  }\n\n\n  // control display of a loading images progress indicator\n  public get showProgress(): any { return { display: (this.loadingImages) ? 'inline' : 'none' } };\n\n\n  // control styling of a button for a tool that can be selected\n  public showSelectedTool(tool: string): any { \n    if (tool == this.selectedTool) { \n      return { 'color': 'rgb(211, 34, 81)', 'border': 'inset 2px', 'border-color': 'whitesmoke', 'background-color': '#343434' }; \n    } \n    else {\n      return { 'color': 'white', 'border-color': '#888888' };\n    }\n  };\n\n\n  // control styling of the StackScroll toggle button\n  public get showButtonToggleEnabled(): any { \n    if (this.viewPort.isScrollEnabled) { \n      return { 'color': 'rgb(211, 34, 81)', 'border': 'inset 2px', 'border-color': 'whitesmoke', 'background-color': '#343434' }; \n    } \n    else {\n      return { 'color': 'white', 'border-color': '#888888' };\n    }\n  };\n\n\n  // control styling of the Play/Stop button\n  public get showPlayStop(): any { \n    if (this.viewPort.isClipPlaying) { \n      return { 'border-color': 'whitesmoke', 'border-style': 'inset 2px' }; \n    } \n    else {\n      return { 'color': 'white', 'border-color': '#888888' };\n    }\n  };\n\n\n  /**\n   * Load dicom images for display\n   *\n   * @param imageIdList list of imageIds to load and display\n   */\n  loadStudyImages(imageIdList: Array<any>) {\n    this.element = this.viewPort.element;\n    this.imageIdList = imageIdList;\n    this.viewPort.resetViewer();\n    this.viewPort.resetImageCache(); // clean up image cache\n    this.seriesList = []; // start a new series list\n    this.currentSeriesIndex = 0; // always display first series\n    this.loadedImages = []; // reset list of images already loaded\n\n    // loop thru all imageIds, load and cache them for exhibition (up the the maximum limit defined)\n    const maxImages = (this.maxImagesToLoad <= 0) ? imageIdList.length : Math.min(this.maxImagesToLoad, imageIdList.length);\n    this.loadingImages = true; // activate progress indicator\n    this.targetImageCount = maxImages;\n    for (let index = 0; index < maxImages; index++) {\n      const imageId = imageIdList[index];\n      cornerstone.loadAndCacheImage(imageId).then(imageData => { this.imageLoaded(imageData) });\n    }\n  }\n\n\n  /**\n   *\n   * @param imageData the dicom image data\n   */\n  private imageLoaded(imageData) {\n    // build list of series in all loadded images\n    const series = {\n      studyID: imageData.data.string('x0020000d'),\n      seriesID: imageData.data.string('x0020000e'),\n      seriesNumber: imageData.data.intString('x00200011'),\n      studyDescription: imageData.data.string('x00081030'),\n      seriesDescription: imageData.data.string('x0008103e'),\n      imageCount: 1,\n      imageList: [imageData]\n    }\n    // if this is a new series, add it to the list\n    let seriesIndex = this.seriesList.findIndex(item => item.seriesID === series.seriesID);\n    if (seriesIndex < 0) {\n      seriesIndex = this.seriesList.length;\n      this.seriesList.push(series);\n      this.seriesList.sort((a, b) => {\n        if (a.seriesNumber > b.seriesNumber) return 1;\n        if (a.seriesNumber < b.seriesNumber) return -1;\n        return 0;\n      })\n    } else {\n      let seriesItem = this.seriesList[seriesIndex];\n      seriesItem.imageCount++;\n      seriesItem.imageList.push(imageData);\n      seriesItem.imageList.sort((a, b) => {\n        if (a.data.intString('x00200013') > b.data.intString('x00200013')) return 1;\n        if (a.data.intString('x00200013') < b.data.intString('x00200013')) return -1;\n        return 0;\n      })\n    }\n\n    this.loadedImages.push(imageData); // save to images loaded\n\n    if (seriesIndex === this.currentSeriesIndex) {\n      this.showSeries(this.currentSeriesIndex)\n    }\n\n    if (this.loadedImages.length >= this.targetImageCount) { // did we finish loading images?\n      this.loadingImages = false; // deactivate progress indicator\n    }\n\n    this.enablePan();\n  }\n\n\n  public showSeries(index) {\n    if (this.viewPort.isClipPlaying) {\n      this.stopClip();\n    }\n\n    this.currentSeriesIndex = index;\n    this.currentSeries = this.seriesList[index];\n    this.imageCount = this.currentSeries.imageCount; // get total image count\n    this.viewPort.resetImageCache(); // clean up image cache\n\n    for (let i = 0; i < this.currentSeries.imageList.length; i++) {\n      const imageData = this.currentSeries.imageList[i];\n      this.viewPort.addImageData(imageData);\n    }\n  }\n\n\n  /**\n   * Image scroll methods\n   */\n  public nextImage() {\n    if (this.imageCount > 1 && this.viewPort.currentIndex < this.imageCount && !this.viewPort.isClipPlaying) {\n      this.viewPort.nextImage();\n    }\n  }\n\n\n  public previousImage() {\n    if (this.viewPort.currentIndex > 0 && !this.viewPort.isClipPlaying) {\n      this.viewPort.previousImage();\n    }\n  }\n\n\n  /**\n   * Methods to activate/deactivate viewer tools\n   */\n  // deactivate all tools\n  public resetAllTools() {\n    if (this.imageCount > 0) {\n      this.selectedTool = this.toolList[0];\n      this.viewPort.resetAllTools();\n      if (this.viewPort.isClipPlaying) {\n        this.stopClip();\n      }\n    }\n  }\n\n\n  // activate windowing\n  public enableWindowing() {\n    if (this.imageCount > 0) {\n      cornerstoneTools.setToolActiveForElement(this.element, 'Wwwc', { mouseButtonMask: 1 }, ['Mouse']);\n      cornerstoneTools.setToolActiveForElement(this.element, 'Pan', { mouseButtonMask: 2 }, ['Mouse']); // pan right mouse\n      this.selectedTool = this.toolList[2];\n    }\n  }\n\n\n  // activate zoom\n  public enableZoom() {\n    if (this.imageCount > 0) {\n      cornerstoneTools.setToolActiveForElement(this.element, 'Zoom', { mouseButtonMask: 1 }, ['Mouse']); // zoom left mouse\n      cornerstoneTools.setToolActiveForElement(this.element, 'Pan', { mouseButtonMask: 2 }, ['Mouse']); // pan right mouse\n      this.selectedTool = this.toolList[1];\n    }\n  }\n\n\n  // activate pan\n  public enablePan() {\n    if (this.imageCount > 0) {\n      cornerstoneTools.setToolActiveForElement(this.element, 'Pan', { mouseButtonMask: 1 }, ['Mouse']);\n      cornerstoneTools.setToolActiveForElement(this.element, 'Pan', { mouseButtonMask: 2 }, ['Mouse']); // pan right mouse\n      this.selectedTool = this.toolList[0];\n    }\n  }\n\n\n  // activate image scroll\n  public enableScroll() {\n    if (this.imageCount > 0) {\n      cornerstoneTools.setToolActiveForElement(this.element, 'StackScroll', { mouseButtonMask: 1 }, ['Mouse']);\n    }\n  }\n\n\n  public toggleScroll() {\n    if (!this.viewPort.isClipPlaying) {\n      this.viewPort.toggleScroll();\n    }\n  }\n\n\n  // activate length measurement\n  public enableLength() {\n    if (this.imageCount > 0) {\n      cornerstoneTools.setToolActiveForElement(this.element, 'Length', { mouseButtonMask: 1 }, ['Mouse']);\n      cornerstoneTools.setToolActiveForElement(this.element, 'Pan', { mouseButtonMask: 2 }, ['Mouse']); // pan right mouse\n      this.annotationsList.push('Length');\n      this.selectedTool = this.toolList[4];\n    }\n  }\n\n\n  // Download data as a .json file\n  public download(filename: any, text: any) {\n    let element = document.createElement('a');\n    element.setAttribute('href', 'data:text/json;charset=utf-8,' + encodeURIComponent(text));\n    element.setAttribute('download', filename + '.json');\n\n    element.style.display = 'none';\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n  }\n\n\n  // save tool states - download annotation data for all images\n  public saveToolState() {\n    \n    let exportArray = this.exportImageArray();\n\n    this.download(\"annotations\", JSON.stringify(exportArray));\n  }\n\n  public exportImageArray(){\n    let exportArray = [];\n\n    // Save viewer state to restore later\n    let lastSeriesSeen = this.currentSeriesIndex;\n    let lastCurrentImageIndex = this.viewPort.currentIndex;\n    \n    for (let i = 0; i < this.seriesList.length; ++i) {\n\n      this.showSeries(i);\n\n      for (let image of this.seriesList[i].imageList) {\n        console.log(image);\n        let imageAnnotations = {\n          studyID: image.data.string('x0020000d'),\n          seriesID: image.data.string('x0020000e'),\n          SOPInstanceUID: image.data.string('x00080018'),\n          annotations: {\n            lengthData: null,\n            rectangleData: null\n          }\n        }\n        \n        let getter = cornerstoneTools.getElementToolStateManager(this.element).get;\n        let lengthToolData = getter(this.element, 'Length');\n        let rectangleRoiToolData = getter(this.element, 'RectangleRoi');\n\n        if (!lengthToolData) imageAnnotations.annotations.lengthData = null;\n        else imageAnnotations.annotations.lengthData = lengthToolData.data;\n        \n        if (!rectangleRoiToolData) imageAnnotations.annotations.rectangleData = null;\n        else imageAnnotations.annotations.rectangleData = rectangleRoiToolData.data;\n        \n        if (lengthToolData || rectangleRoiToolData) {\n          exportArray.push(imageAnnotations);\n        }\n\n        this.nextImage();\n      }\n\n      return exportArray;\n    }\n\n    // Restore viewer state after iterating through images\n    this.showSeries(lastSeriesSeen);\n\n    while (this.viewPort.currentIndex < lastCurrentImageIndex) {\n      this.viewPort.nextImage();\n    }\n  }\n\n  // Load tool states from a .json file, restoring them to the viewer\n  public loadToolState(event) {\n    if (this.imageCount < 1)\n      return; // Must have image(s) loaded to restore annotations\n\n    let file = event[0];\n    let reader = new FileReader();\n    reader.readAsText(file, \"UTF-8\");\n\n    reader.onload = ((evt) => {\n\n      let idToAnnotation = new Map();\n      let jsonObj = JSON.parse(evt.target.result as string);\n\n      // Populate the image id -> annotation map\n      for (let element of jsonObj) { \n        idToAnnotation.set(element.SOPInstanceUID, element.annotations);\n      }\n\n      // Save viewer state to restore later\n      let lastSeriesSeen = this.currentSeriesIndex;\n      let lastCurrentImageIndex = this.viewPort.currentIndex;\n      \n      // Flip through all loaded images and restore tool state for each\n      for (let i = 0; i < this.seriesList.length; ++i) {\n\n        this.showSeries(i);\n\n        for (let image of this.seriesList[i].imageList) {\n\n          let currSOPInstanceUID = image.data.string('x00080018');\n          let rectData, lengthData;\n\n          if (idToAnnotation.has(currSOPInstanceUID)) {\n            let annotations = idToAnnotation.get(currSOPInstanceUID);\n            rectData = annotations.rectangleData;\n            lengthData = annotations.lengthData;\n          }\n          \n          // Restore RectangleRoi annotations for current image\n          if (rectData != null) {\n            for (let item of rectData) {\n              cornerstoneTools.addToolState(this.element, 'RectangleRoi', item);\n            }\n          }\n\n          // Restore Length annotations for current image\n          if (lengthData != null) {\n            for (let item of lengthData) {\n              cornerstoneTools.addToolState(this.element, 'Length', item);\n            }\n          }\n          \n          this.nextImage();\n        }\n      }\n\n      // Trigger the annotations to render again by activating tools\n      this.enableRectangle();\n      this.enableLength();\n      this.enablePan();\n\n      // Restore viewer state after iterating through images\n      this.showSeries(lastSeriesSeen);\n\n      while (this.viewPort.currentIndex < lastCurrentImageIndex) {\n        this.viewPort.nextImage();\n      }\n\n      this.viewPort.refreshImage();\n    });\n\n    // File error handler\n    reader.onerror = (() => {\n      console.log(\"Error reading JSON file.\");\n    });\n  }\n\n\n  // activate Rectangle ROI\n  public enableRectangle() {\n    if (this.imageCount > 0) {\n      cornerstoneTools.setToolActiveForElement(this.element, 'RectangleRoi', { mouseButtonMask: 1 }, ['Mouse']);\n      cornerstoneTools.setToolActiveForElement(this.element, 'Pan', { mouseButtonMask: 2 }, ['Mouse']); // pan right mouse\n      this.annotationsList.push('RectangleRoi');\n      this.selectedTool = this.toolList[3];\n    }\n  }\n\n\n  // Toggle clip playing\n  public togglePlay() {\n    if (this.viewPort.isClipPlaying) {\n      this.stopClip();\n    }\n    else {\n      this.playClip();\n    }\n  }\n\n  \n  // Play Clip\n  public playClip() {\n    if (this.imageCount > 0) {\n      if (this.viewPort.isScrollEnabled) {\n        this.viewPort.toggleScroll(); // Important to not change image while clip playing\n      }\n      let frameRate = 10;\n      let stackState = cornerstoneTools.getToolState(this.element, 'stack');\n      if (stackState) {\n        frameRate = stackState.data[0].frameRate;\n        // Play at a default 10 FPS if the framerate is not specified\n        if (frameRate === undefined || frameRate === null || frameRate === 0) {\n          frameRate = 10;\n        }\n      }\n      this.viewPort.togglePlayClip();\n      cornerstoneTools.playClip(this.element, frameRate);\n    }\n  }\n\n\n  // Stop Clip\n  public stopClip() {\n    this.viewPort.togglePlayClip();\n    cornerstoneTools.stopClip(this.element);\n    this.viewPort.refreshImage();\n  }\n\n\n  // invert image\n  public invertImage() {\n    if (this.imageCount > 0) {\n      let viewport = cornerstone.getViewport(this.element);\n      // Toggle invert\n      viewport.invert = !viewport.invert;\n      cornerstone.setViewport(this.element, viewport);\n    }\n  }\n\n\n  // Undo Last Annotation\n  /*\n  This method currently removes all annotations from the last used tool. \n  Example: if the user used the Length tool twice, followed by the RectangleROI tool twice, and then \n  clicks \"Undo\", this method will clear both of the rectangle annotations. If the user clicks undo again,\n  this method will clear both of the length annotations.\n  */\n  public undoAnnotation() {\n    let popped = this.annotationsList.pop();\n    cornerstoneTools.clearToolState(this.element, popped);\n    this.viewPort.displayImage(this.viewPort.imageList[this.viewPort.currentIndex]);\n  }\n\n\n  // reset image\n  public resetImage() {\n    if (confirm(\"Are you sure you want to reset all annotations?\") == true) {\n      if (this.imageCount > 0) {\n        cornerstoneTools.clearToolState(this.element, \"Length\");\n        cornerstoneTools.clearToolState(this.element, \"Angle\");\n        cornerstoneTools.clearToolState(this.element, \"Probe\");\n        cornerstoneTools.clearToolState(this.element, \"EllipticalRoi\");\n        cornerstoneTools.clearToolState(this.element, \"RectangleRoi\");\n\n        this.viewPort.displayImage(this.viewPort.imageList[this.viewPort.currentIndex]);\n      } \n    } \n  }\n\n\n  public clearImage() {\n    this.viewPort.resetViewer();\n    this.viewPort.resetImageCache();\n    this.seriesList = []; // list of series on the images being displayed\n    this.currentSeriesIndex = 0;\n    this.currentSeries = {};\n    this.imageCount = 0; // total image count being viewed\n  }\n\n  public getActualImage(image){\n    // this.realImage = image;\n    image.arrayBuffer().then((arrayBuffer) => {\n      this.realImage = new Blob([new Uint8Array(arrayBuffer)], {type: image.type });\n        console.log(this.realImage);\n    });\n  }\n\n  ///// Redirect to the URL\n  public redirectToGit(){\n    \n    // alert(  123);\n\n    let exportArray = this.exportImageArray();\n    console.log(this.realImage);\n    let formData = new FormData();\n    formData.append('image', this.realImage, this.realImage.name);\n    console.log(formData)\n    formData.append('annotation', JSON.stringify(exportArray));\n\n    this.http.post<any>(`${this.baseUrl}`, formData).subscribe(response => {\n      let url = this.baseUrl+\"show-images\";   \n      window.open(url, '_blank');\n    })\n\n  }\n\n}\n\n\n\n","<div style=\"display: flex; width:100%; height: 100%;\">\n\n    <!-- Thumbnail selector -->\n    <div class=\"thumbnailSelector\" style=\"margin-right: 1px;\">\n        <div class=\"thumbnails list-group\" style=\"height: 100%;\">\n            <a *ngFor=\"let series of seriesList; let i=index\" [ngClass]=\"{'active': currentSeriesIndex === i}\" class=\"list-group-item\"\n                oncontextmenu=\"return false\" unselectable=\"on\" onselectstart=\"return false;\" onmousedown=\"return false;\"\n                (click)=\"showSeries(i)\">\n                <div thumbnail [imageData]=\"series.imageList[0]\" class=\"csthumbnail\" oncontextmenu=\"return false\"\n                    unselectable=\"on\" onselectstart=\"return false;\" onmousedown=\"return false;\">\n                </div>\n                <div class=\"text-center small\" style=\"color:white;\">{{series.seriesDescription}}</div>\n                <div id=\"mrtopright\" style=\"position: absolute;top:3px; right:3px\">\n                    <div id=\"imageCount\" style=\"color: #e9e9e9; font-size: 14pt;\">{{series.imageCount}}</div>\n                </div>\n            </a>\n        </div>\n    </div>\n\n    <!-- container where image will be loaded -->\n    <div style=\"overflow: hidden; width: 100%; height: 100%; background-color: #252525;\">\n        <!-- Toolbar -->\n        <div style=\"border: 2px groove #2c2c2c; scrollbar-width: none;\">\n            <!-- <a>File</a> | <a>Options</a> PLACEHOLDER -->\n            <div class=\"btn-group\" style=\"margin-left: 32%; margin-bottom: 2px; border: 1px solid #4b4b4b; border-style: inset;\">\n                <div class=\"btn-group\" *ngIf=\"enableViewerTools\">\n                    <!-- Pan -->\n                    <button type=\"button\" (click)=\"redirectToGit()\" class=\"btn btn-sm btn-default\" id='pan_bttn' [ngStyle]=\"showSelectedTool('Pan')\"\n                        data-container='body' data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Pan\"><span class=\"fa fa-search\"></span></button>\n                    <button type=\"button\" (click)=\"enablePan()\" class=\"btn btn-sm btn-default\" id='pan_bttn' [ngStyle]=\"showSelectedTool('Pan')\"\n                        data-container='body' data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Pan\"><span class=\"fa fa-arrows-alt\"></span></button>\n                    <!-- Zoom -->\n                    <button type=\"button\" (click)=\"enableZoom()\" class=\"btn btn-sm btn-default\" id='zoom_bttn' [ngStyle]=\"showSelectedTool('Zoom')\"\n                        data-container='body' data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Zoom\"><span class=\"fas fa-search-plus\"></span></button>\n                    <!-- WW/WL -->\n                    <button type=\"button\" (click)=\"enableWindowing()\" class=\"btn btn-sm btn-default\" id='windowing_bttn' [ngStyle]=\"showSelectedTool('Wwwc')\"\n                        data-container='body' data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Windowing\"><span class=\"fa fa-sun\"></span></button>\n                    <!-- Invert -->\n                    <button type=\"button\" (click)=\"invertImage()\" class=\"btn btn-sm btn-default\" data-container='body' id='invert_bttn'\n                        data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Invert\"><span class=\"fa fa-adjust\"></span></button>\n                    <!-- Rectangle ROI -->\n                    <button type=\"button\" (click)=\"enableRectangle()\" class=\"btn btn-sm btn-default\" id='rectangleroi_bttn' [ngStyle]=\"showSelectedTool('RectangleRoi')\"\n                        data-container='body' data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Rectangle ROI\"><span class=\"far fa-square\"></span></button>\n                    <!-- Length measurement -->\n                    <button type=\"button\" (click)=\"enableLength()\" class=\"btn btn-sm btn-default\" id='length_bttn' [ngStyle]=\"showSelectedTool('Length')\"\n                        data-container='body' data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Length\"><span class=\"fas fa-ruler-horizontal\"></span></button>\n                    <!-- Save data -->\n                    <button type=\"button\" (click)=\"saveToolState()\" class=\"btn btn-sm btn-default\" data-container='body' id='export_bttn'\n                        data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Download Annotation Data\"><span class=\"fa fa-download\"></span></button>\n                    <!-- Undo Annotation -->\n                    <button type=\"button\" (click)=\"undoAnnotation()\" class=\"btn btn-sm btn-default\" data-container='body' id='undo_bttn'\n                        data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Undo Annotation\"><span class=\"fas fa-undo\"></span></button>\n                    <!-- Reset Image -->\n                    <button type=\"button\" (click)=\"resetImage()\" class=\"btn btn-sm btn-default\" data-container='body' id='reset_bttn'\n                        data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Reset All Annotations\"><span class=\"fas fa-trash-alt\"></span></button>\n                </div>\n                <div class=\"btn-group\">\n                    <!-- Previous Image -->\n                    <button type=\"button\" (click)=\"previousImage()\" id=\"previous_image_bttn\"\n                        class=\"btn btn-sm btn-default\" data-container='body' data-toggle=\"tooltip\" data-placement=\"bottom\" \n                        title=\"Previous Image\"><span class=\"fa fa-backward\"></span></button>\n                    <!-- Toggle Play/Stop clip -->\n                    <button type=\"button\" *ngIf=\"enablePlayTools\" (click)=\"togglePlay()\" class=\"btn btn-sm btn-default\" [ngStyle]=\"showPlayStop\"\n                        data-container='body' data-toggle=\"tooltip\" data-placement=\"bottom\" id=\"play_bttn\">\n                        <span class=\"fa fa-play\" title=\"Play Clip\" *ngIf=\"!this.viewPort.isClipPlaying\"></span>\n                        <span class=\"fa fa-stop\" title=\"Stop Clip\" *ngIf=\"this.viewPort.isClipPlaying\" style=\"color:rgb(211, 34, 81);\"></span>\n                    </button>\n                    <!-- Next Image -->\n                    <button type=\"button\" (click)=\"nextImage()\" class=\"btn btn-sm btn-default\" id=\"next_image_bttn\"\n                        data-container='body' data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Next Image\"><span class=\"fa fa-forward\"></span></button>             \n                    <!-- Stack scroll -->\n                    <button type=\"button\" (click)=\"toggleScroll()\" class=\"btn btn-sm btn-default\" [ngStyle]=\"showButtonToggleEnabled\" data-container='body' id='stackscroll_bttn'\n                        data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"Toggle Stack Scroll\"><span class=\"fa fa-bars\"></span></button>\n                </div>\n            </div> \n            <!-- Progress Spinner -->\n            <div [ngStyle]=\"showProgress\">\n                <mat-spinner style=\"scrollbar-width: none; float: inline-end; margin-top: 7px; margin-right: 7px;\" diameter=\"35\" strokeWidth=\"3\" color=\"accent\"></mat-spinner>\n            </div>\n        </div>\n\n\n        <!-- Viewer -->\n        <div style=\"width: 100%; height: calc(100% - 60px); position:relative; display:inline-block; color:white;\"\n            oncontextmenu=\"return false\" class='cornerstone-enabled-image' unselectable='on' onselectstart='return false;'\n            onmousedown='return false;'>\n            <div cornerstone style=\"width: 100%; height: 100%; top:0px; left:0px; position:absolute; outline:none; margin: 0 auto;\"\n                id=\"dicomImage\">\n            </div>\n            <div class=\"viewer-text\" id=\"mrtopright\" style=\"position:absolute; right:3px; top:3x;\">\n                <div *ngIf=\"viewPort.patientName != ''\">\n                    <b>Patient:</b> {{viewPort.patientName}}\n                </div>\n                <div *ngIf=\"viewPort.instanceNumber != ''\">\n                    <b>Instance:</b> {{viewPort.instanceNumber}}\n                </div>\n            </div>\n            <div class=\"viewer-text\" id=\"mrbottomleft\" style=\"position:absolute; bottom:3px; left:3px\">\n                <div>\n                    <b>WW/WL:</b> {{viewPort.windowingValue}}\n                </div>\n                <div id=\"zoomText\"><b>Zoom:</b> {{viewPort.zoomValue}}</div>\n            </div>\n            <div class=\"viewer-text\" id=\"mrbottomright\" style=\"position:absolute; bottom:6px; right:3px\">\n                <div id=\"sliceText\"><b>Image:</b> {{(imageCount > 0)?viewPort.currentIndex+1:0}}/{{imageCount}}</div>\n            </div>\n        </div>\n\n\n    </div>\n</div>\n","import { NgModule } from '@angular/core';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon'\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MAT_FORM_FIELD_DEFAULT_OPTIONS } from '@angular/material/form-field';\nimport { HttpClientModule } from '@angular/common/http';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from './app.component';\n\nimport { DicomViewerModule } from './dicom-viewer/dicom-viewer.module';\nimport { InfoDialogComponent } from './info-dialog/info-dialog.component';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { DragdropDirective } from './dragdrop/dragdrop.directive';\n\n@NgModule({\n  declarations: [\n    AppComponent,\n    InfoDialogComponent,\n    DragdropDirective\n  ],\n  imports: [\n    BrowserModule,\n    BrowserAnimationsModule,\n    AppRoutingModule,\n    FormsModule,\n    DicomViewerModule,\n    MatButtonModule,\n    MatIconModule,\n    MatDialogModule,\n    ReactiveFormsModule,\n    HttpClientModule\n  ],\n  providers: [\n    { provide: MAT_FORM_FIELD_DEFAULT_OPTIONS, useValue: { appearance: 'fill' } },\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }","import { Directive, HostBinding, Output, HostListener, EventEmitter } from '@angular/core';\n\n\n@Directive({\n  selector: '[appDragdrop]'\n})\nexport class DragdropDirective {\n\n  @HostBinding('class.fileover') fileOver: boolean;\n  @Output() fileDropped = new EventEmitter<any>();\n\n  constructor() { }\n\n\n  // Dragover listener\n  @HostListener('dragover', ['$event']) onDragOver(evt) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    this.fileOver = true;\n  }\n\n\n  // Dragleave listener\n  @HostListener('dragleave', ['$event']) public onDragLeave(evt) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    this.fileOver = false;\n  }\n\n\n  // Drop listener\n  @HostListener('drop', ['$event']) public ondrop(evt) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    this.fileOver = false;\n    let files = evt.dataTransfer.files;\n    if (files.length > 0) {\n      this.fileDropped.emit(files);\n    }\n  }\n\n}\n","import { Directive, ElementRef, HostListener, OnInit } from '@angular/core';\nimport * as Hammer from 'hammerjs';\n\n\ndeclare const cornerstone;\ndeclare const cornerstoneTools;\ndeclare const cornerstoneMath;\n\n\n@Directive({\n  selector: '[cornerstone]',\n})\nexport class CornerstoneDirective implements OnInit {\n\n  public element: any;\n  \n  private fontFamily = '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"'; \n  private fontSize = '15px';\n\n  public imageList = [];\n  private imageIdList = [];\n  public currentIndex = 0;\n  public currentImage: any;\n  public patientName = '';    // current image Patient name, to display on the overlay\n  public hospital = '';       // current image Institution name, to display on the overlay\n  public instanceNumber = ''; // current image Instance #, to display on the overlay\n\n  private scrollEnabled = false;\n\n  private isCornerstoneEnabled = false;\n  private clipPlaying = false;\n  \n  // Cornerstone Tools we use\n  private WwwcTool = cornerstoneTools.WwwcTool;\n  private PanTool = cornerstoneTools.PanTool;\n  private ZoomTool = cornerstoneTools.ZoomTool;\n  private LengthTool = cornerstoneTools.LengthTool;\n  private RectangleRoiTool = cornerstoneTools.RectangleRoiTool;\n  private ZoomTouchPinchTool = cornerstoneTools.ZoomTouchPinchTool;\n  private PanMultiTouchTool = cornerstoneTools.PanMultiTouchTool;\n  private StackScrollTool = cornerstoneTools.StackScrollTool;\n\n\n  constructor(private elementRef: ElementRef) {\n  }\n\n\n  @HostListener('window:resize', ['$event'])\n  onResize(event) {\n    if (this.isCornerstoneEnabled) {\n      cornerstone.resize(this.element, true);\n    }\n  }\n\n\n  @HostListener('wheel', ['$event'])\n  onMouseWheel(event) {\n    if (this.imageList.length > 0 && this.scrollEnabled) {\n\n      if (event.deltaY > 0) {\n        this.currentIndex++;\n        if (this.currentIndex >= this.imageList.length) {\n          this.currentIndex = this.imageList.length - 1;\n        }\n      } else {\n\n        this.currentIndex--;\n        if (this.currentIndex < 0) {\n          this.currentIndex = 0;\n        }\n\n      }\n\n      this.displayImage(this.imageList[this.currentIndex]);\n    }\n  }\n\n\n  ngOnInit() {\n    // Retrieve the DOM element itself\n    this.element = this.elementRef.nativeElement;\n\n    // now add the Tools we use\n    cornerstoneTools.external.cornerstone = cornerstone;\n    cornerstoneTools.external.Hammer = Hammer;\n    cornerstoneTools.external.cornerstoneMath = cornerstoneMath;\n    cornerstoneTools.init({ globalToolSyncEnabled: true });\n\n    cornerstoneTools.textStyle.setFont(this.fontSize + ' ' + this.fontFamily);\n\n    cornerstoneTools.toolStyle.setToolWidth(1); // thickness of RectangleRoi or Length tool lines\n    cornerstoneTools.toolColors.setToolColor('rgb(255, 255, 0)'); // Set color for inactive tools\n    cornerstoneTools.toolColors.setActiveColor('rgb(0, 255, 0)'); // Set color for active tools\n\n    cornerstoneTools.addTool(this.WwwcTool);\n    cornerstoneTools.addTool(this.PanTool);\n    cornerstoneTools.addTool(this.ZoomTool);\n    cornerstoneTools.addTool(this.LengthTool);\n    cornerstoneTools.addTool(this.RectangleRoiTool);\n    cornerstoneTools.addTool(this.ZoomTouchPinchTool);\n    cornerstoneTools.addTool(this.PanMultiTouchTool);\n    cornerstoneTools.addTool(this.StackScrollTool);\n\n    // Enable the element with Cornerstone\n    this.resetViewer();\n  }\n\n\n  public get windowingValue(): string {\n    if (this.isCornerstoneEnabled) {\n      let viewport = cornerstone.getViewport(this.element);\n      if (this.currentImage && viewport) { return Math.round(viewport.voi.windowWidth) + \"/\" + Math.round(viewport.voi.windowCenter); }\n    }\n    return '';\n  }\n\n\n  public get zoomValue(): string {\n    if (this.isCornerstoneEnabled) {\n      let viewport = cornerstone.getViewport(this.element);\n      if (this.currentImage && viewport) { return viewport.scale.toFixed(2); }\n    }\n    return '';\n  }\n\n\n  public get isClipPlaying(): boolean {\n    return this.clipPlaying;\n  }\n\n\n  public get isScrollEnabled(): boolean {\n    return this.scrollEnabled;\n  }\n\n\n  public resetViewer() {\n    this.disableViewer();\n    cornerstone.enable(this.element);\n    this.isCornerstoneEnabled = true;\n  }\n\n\n  public disableViewer() {\n    this.element = this.elementRef.nativeElement;\n    try {\n      cornerstone.disable(this.element);\n    } finally { }\n\n    this.isCornerstoneEnabled = false;\n  }\n\n\n  public resetImageCache() {\n    this.imageList = [];\n    this.imageIdList = [];\n    this.currentImage = null;\n    this.currentIndex = 0;\n    this.patientName = '';\n    this.hospital = '';\n    this.instanceNumber = '';\n  }\n\n\n  public previousImage() {\n    if (this.imageList.length > 0) {\n      this.currentIndex--;\n      if (this.currentIndex < 0) {\n        this.currentIndex = 0;\n      }\n      this.displayImage(this.imageList[this.currentIndex]);\n    }\n  }\n\n\n  public nextImage() {\n    if (this.imageList.length > 0) {\n      this.currentIndex++;\n      if (this.currentIndex >= this.imageList.length) {\n        this.currentIndex = this.imageList.length - 1;\n      }\n      this.displayImage(this.imageList[this.currentIndex]);\n    }\n  }\n\n\n  public refreshImage() {\n    this.displayImage(this.imageList[this.currentIndex]);\n  }\n\n\n  public toggleScroll() {\n    this.scrollEnabled = !this.scrollEnabled;\n  }\n\n\n  public togglePlayClip() {\n    this.clipPlaying = !this.clipPlaying;\n  }\n\n\n  public addImageData(imageData: any) {\n    this.element = this.elementRef.nativeElement;\n    this.imageList.push(imageData);\n    this.imageIdList.push(imageData.imageId);\n\n    if (this.imageList.length === 1) {\n      this.currentIndex = 0;\n      this.displayImage(imageData);\n    }\n\n    cornerstone.resize(this.element, true);\n  }\n\n\n  public displayImage(image) {\n    this.element = this.elementRef.nativeElement;\n    const viewport = cornerstone.getDefaultViewportForImage(this.element, image);\n    cornerstone.displayImage(this.element, image, viewport);\n    this.currentImage = image;\n\n    // Fit the image to the viewport window\n    cornerstone.fitToWindow(this.element);\n    cornerstone.resize(this.element, true);\n\n    // get image info to display in overlays\n    if (image.data.string('x00100010')) this.patientName = image.data.string('x00100010').replace(/\\^/g, '');\n    this.hospital = image.data.string('x00080080');\n    this.instanceNumber = image.data.intString('x00200011') + '/' + image.data.intString('x00200013');\n\n    // Define the Stack object\n    const stack = {\n      currentImageIdIndex: this.currentIndex,\n      imageIds: this.imageIdList\n    };\n\n    cornerstoneTools.addStackStateManager(this.element, ['playClip']);\n    // Add the stack tool state to the enabled element\n    cornerstoneTools.addStackStateManager(this.element, ['stack']);\n    cornerstoneTools.addToolState(this.element, 'stack', stack);\n\n    // Enable all tools we want to use with this element\n    cornerstoneTools.setToolActiveForElement(this.element, 'StackScroll', {});\n  }\n\n\n  // deactivate all tools\n  public resetAllTools() {\n    cornerstoneTools.setToolDisabledForElement(this.element, 'Wwwc');\n    cornerstoneTools.setToolDisabledForElement(this.element, 'Pan');\n    cornerstoneTools.setToolDisabledForElement(this.element, 'Zoom');\n    cornerstoneTools.setToolDisabledForElement(this.element, 'Length');\n    cornerstoneTools.setToolDisabledForElement(this.element, 'RectangleRoi');\n    cornerstoneTools.setToolDisabledForElement(this.element, 'ZoomTouchPinch');\n    cornerstoneTools.setToolDisabledForElement(this.element, 'PanMultiTouch');\n    cornerstoneTools.setToolDisabledForElement(this.element, 'StackScroll');\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nconst routes: Routes = [];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes)],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule { }\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err));\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"zn8P\";"]}